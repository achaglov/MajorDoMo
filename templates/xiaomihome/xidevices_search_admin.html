<!-- table xidevices search -->
<table width=100% border=0>
   <tr>
      <td valign=top>
         <!-- results -->
         [#if RESULT#]
            <!-- paging -->
            [#if PAGES#]
            <table border=0>
               <td align=right><b>Pages:</b>&nbsp;</td>
               [#begin PREVPAGE#]<td><a href="?data_source=<#DATA_SOURCE#>&view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">&lt;&lt;&lt;</a></td>[#end PREVPAGE#]
               <td>
               [#begin PAGES#]
                  [#if !SELECTED#]<a href="?data_source=<#DATA_SOURCE#>&view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">[#else#]<b>[#endif#][#NUM#]</b></a>
               [#end PAGES#]
               </td>
               [#begin NEXTPAGE#]<td><a href="?data_source=<#DATA_SOURCE#>&view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">&gt;&gt;&gt;</a></td>[#end NEXTPAGE#]
            </table>
            [#endif PAGES#]
            <!-- / paging -->
            <!-- search results (list) -->
               <table  align=center class="table table-striped">
                  <form action="?" method="post" id="frmList_xidevices" name="frmList_xidevices" class="form">
                  <thead>
                  <tr>
                     <th></th>
                     <th><a href="?sortby=title"><#LANG_TITLE#></a></th>
                     <th>
                        <select name="type" class="form-control" onchange="$('#frmList_xidevices').submit();">
                           <option value="all"><#LANG_ALL#></option>
                           [#begin TYPES#]
                           <option value="[#TYPE#]"[#if TYPE="<#TYPE#>"#] selected[#endif#]>[#TYPE#] ([#TOTAL#])</option>
                           [#end TYPES#]
                        </select>
                     </th>
                     <th>SID</th>
                     <!--#
                     <th>IP</th>
                     #-->
                     <th><a href="?sortby=updated"><#LANG_UPDATED#></a></th>
                     <th>&nbsp;</th>
                  </tr>
                  </thead>
                  </form>
                  <tbody>
                  [#begin RESULT#]
                  <tr style="height:52px" class="hover_btn2">
                     <td style="vertical-align:middle">
                        <img src="../templates/xiaomihome/img/[#TYPE#].png" height="40px" onerror="this.src='../templates/xiaomihome/img/unknown.png'">
                     </td>
                     <td style="vertical-align:middle [#if LOST#] ;color:lightgray;font-weight:bold;[#endif#]">
                     
                        <b>[#TITLE#]</b>
                        [#if POWER!=""#]
                           <span class="label label-[#POWER_WARNING#]"><i class="glyphicon glyphicon-flash"></i> [#POWER#]%</span>
                        [#endif#]
                        <div id="device[#ID#]_commands">[#COMMANDS#]</div>
                     </td>

                     <td style="vertical-align:middle [#if LOST#] ;color:lightgray;font-weight:bold;[#endif#]">[#TYPE#]</td>
                     <td style="vertical-align:middle [#if LOST#] ;color:lightgray;font-weight:bold;[#endif#]">
                        [#if SID!=""#]
                           [#SID#]
                        [#else#]
                           &nbsp;
                        [#endif#]
                     </td>
                     <!--#
                     <td style="vertical-align:middle">[#GATE_IP#]</td>
                     #-->
                     <td style="vertical-align:middle [#if LOST#] ;color:lightgray;font-weight:bold;[#endif#]" id="device[#ID#]_updated">[#if UPDATED!=""#][#UPDATED#][#else#]&nbsp;[#endif#]</td>
                     <td style="vertical-align:middle" width="1%" nowrap>
                        <div style="width:120px">
                           [#if "<#ACTION#>"=="admin"#]
                              <a href="?data_source=<#DATA_SOURCE#>&view_mode=edit_xidevices&id=[#ID#]" class="btn btn-default" title="<#LANG_EDIT#>"><i class="glyphicon glyphicon-pencil"></i></a>
                           <a href="?data_source=<#DATA_SOURCE#>&view_mode=edit_xidevices&id=[#ID#]&tab=data" class="btn btn-default" title="<#LANG_DATA#>"><i class="glyphicon glyphicon-th-list"></i></a>
                              <a href="?data_source=<#DATA_SOURCE#>&view_mode=delete_xidevices&id=[#ID#]" onClick="return confirm('<#LANG_ARE_YOU_SURE#>')" class="btn btn-default" title="Удалить"><i class="glyphicon glyphicon-remove"></i></a>
                           [#endif ACTION#]
                        </div>
                     </td>
                  </tr>
                  [#end RESULT#]
                  </tbody>
               </table>
            <!-- / search results (list) -->
            <!-- paging -->
            [#if PAGES#]
            <table border=0>
               <td align=right><b>Pages:</b>&nbsp;</td>
               [#begin PREVPAGE#]<td><a href="?data_source=<#DATA_SOURCE#>&view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">&lt;&lt;&lt;</a></td>[#end PREVPAGE#]
               <td>
                  [#begin PAGES#]
                     [#if !SELECTED#]<a href="?data_source=<#DATA_SOURCE#>&view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">[#else#]<b>[#endif#][#NUM#]</b></a>
                  [#end PAGES#]
               </td>
               [#begin NEXTPAGE#]<td><a href="?data_source=<#DATA_SOURCE#>&view_mode=<#VIEW_MODE#>&mode=<#MODE#>&save_qry=1&page=[#NUM#]">&gt;&gt;&gt;</a></td>[#end NEXTPAGE#]
            </table>
            [#endif PAGES#]
            <!-- / paging -->
         [#else RESULT#]
            <p>
               <font color="red"><#LANG_NO_RECORDS_FOUND#></font>
            </p>
         [#endif RESULT#]
         <!-- / results -->
      </td>
   </tr>
</table>
<script type="text/javascript">
   var refreshTimer=0;
   var latestTm=0;
   function refreshDevicesData() {
      var url="?ajax=1&data_updated="+latestTm;
      $.ajax({
         url: url
      }).done(function(data) {
         var obj=jQuery.parseJSON(data);
         if (obj.ITEMS.length>0) {
            for(var i=0;i<obj.ITEMS.length;i++) {
               var id = obj.ITEMS[i].ID;
               var commands = obj.ITEMS[i].COMMANDS;
               $('#device'+id+'_commands').html(commands);
               $('#device'+id+'_updated').html(obj.ITEMS[i].UPDATED);
               $('#device'+id+'_commands').fadeTo(100, 0.1).fadeTo(200, 1.0);
               $('#device'+id+'_updated').fadeTo(100, 0.1).fadeTo(200, 1.0);
            }
         }
         latestTm = obj.TM;
      });
      refreshTimer = setTimeout('refreshDevicesData();',2000);
   }
   refreshTimer = setTimeout('refreshDevicesData();',2000);
</script>